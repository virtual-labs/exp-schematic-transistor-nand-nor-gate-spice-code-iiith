<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual labs</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/css/style.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.15.6/js/jsplumb.min.js"></script>
    <link rel="stylesheet" href="./css/main.css" />
    <style>
      @media (max-width: 600px) {
        .button-group-mobile {
          display: flex;
          flex-direction: column;
          gap: 0.5em;
        }
      }
    </style>
  </head>
  <body>
    <div
      class="columns mt-2 is-variable is-1 is-centered is-flex is-flex-wrap-wrap"
    >
      <div class="v-tabs">
        <ul>
          <li class="is-active">
            <a>
              <span>NAND GATE</span>
            </a>
          </li>
          <li>
            <a>
              <span>NOR GATE</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="columns is-centered">
      <div class="column">
        <div
          class="v-collapsible-instruction-container v-instruction-container"
        >
          <div class="v-collapsible is-size-5" id="task-description">
            Instructions
          </div>
          <div
            class="v-content"
            style="text-align: left; padding-left: 10%; padding-right: 10%"
          >
            <ul style="list-style: disc">
              <li>
                The Spice Code is divided into colored code blocks. Each color
                represents a key part of the NAND/NOR gate simulation.
              </li>
              <li>
                <b>Blue block:</b> MOSFET model file (<code>PTM_45nm.txt</code>)
                and parameter declarations.
              </li>
              <li>
                <b>Green block:</b> Define the voltage source (<code>vdd</code>
                as positive, <code>gnd</code> or <code>0</code> as negative).
              </li>
              <li>
                <b>Yellow block:</b> NAND/NOR subcircuit definition, including
                input/output names and PMOS/NMOS connections.
              </li>
              <li>
                <b>Red block:</b> Instantiate the NAND/NOR subcircuit in your
                main code.
              </li>
              <li><b>Teal block:</b> Declare the input waveform.</li>
              <li>
                <b>Purple block:</b> Add control statements to run and plot the
                simulation.
              </li>
              <li><b>Gray block:</b> End your SPICE code.</li>
            </ul>
            <div style="margin-top: 1em">
              <b>Steps to Build Your Code:</b>
              <ol style="list-style: decimal">
                <li>
                  Arrange the colored blocks in the order listed above for a
                  valid simulation.
                </li>
                <li>
                  Fill in the blanks in each block with the required values and
                  names.
                </li>
                <li>
                  Click <b>Validate</b> to check your code. If correct, you will
                  see a report and input/output graphs.
                </li>
                <li>
                  If your arrangement is valid but differs from the standard
                  diagram, you will see a message: <br /><i
                    >"Your arrangement is correct, even though it differs from
                    the diagram. Multiple transistor arrangements are possible
                    for this logic gate."</i
                  >
                </li>
                <li>
                  Click <b>Reset</b> to start over. Click
                  <b>View PTM_45nm.txt</b> to see the MOSFET model file.
                </li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="columns is-variable is-1 is-centered is-flex is-flex-wrap-wrap my-0"
    >
      <div class="column is-12-mobile is-4-tablet is-4-desktop center-content">
        <div class="button-group-mobile">
          <button
            class="v-button"
            style="width: 100%; margin-bottom: 0.5em"
            onclick="ValidateCode()"
          >
            Validate
          </button>
          <button
            class="v-button"
            style="width: 100%; margin-bottom: 0.5em"
            onclick="viewModelFile()"
          >
            View PTM_45nm.txt
          </button>
          <button
            class="v-button"
            style="width: 100%"
            onclick="location.reload()"
          >
            Reset
          </button>
        </div>
      </div>
    </div>
    <div class="columns is-variable is-5 is-centered is-flex is-flex-wrap-wrap">
      <div class="column is-9-desktop is-10-tablet is-11-mobile center-content">
        <div class="v-datalist-container">
          <div class="v-datalist-title">Spice Code</div>
          <div id="container">
            <ul class="drag-sort-enable custom-list" id="spice-code">
              <li
                id="1"
                style="border-left: 6px solid #3273dc; background: #eaf6fb"
              >
                <span class="comment" id="first_line"></span>
                <p>
                  .include
                  <input
                    type="text"
                    id="file-name"
                    placeholder="Enter the model file name to be included"
                  />
                </p>
                <br />
                <p><span class="comment">* Parameter Declarations </span></p>
                <p>
                  .PARAM supply=1.1<br />
                  .PARAM Lmin=45nm<br />
                  .PARAM Wmin=45nm<br />
                  .PARAM Wp={2*Wmin}<br />
                  .global vdd gnd
                </p>
              </li>
              <li
                id="2"
                style="border-left: 6px solid #23d160; background: #eaffea"
              >
                <span class="comment"
                  >* Netlist statement to define voltage source
                </span>
                <p>
                  <input
                    type="text"
                    id="voltage-source-name"
                    placeholder="Give a name to the voltage source"
                  />&nbsp;
                  <select id="voltage-positive-terminal-selector">
                    <option value="" disabled selected>
                      Select positive terminal node
                    </option>
                    <option value="vdd">vdd</option>
                    <option value="gnd">gnd</option>
                    <option value="0">0</option>
                    <option value="1.1">1.1</option>
                  </select>
                  <select id="voltage-negative-terminal-selector">
                    <option value="" disabled selected>
                      Select negative terminal node
                    </option>
                    <option value="vdd">vdd</option>
                    <option value="gnd">gnd</option>
                    <option value="0">0</option>
                    <option value="1.1">1.1</option>
                  </select>
                </p>
              </li>
              <li
                id="3"
                style="border-left: 6px solid #ffdd57; background: #fffbe6"
              >
                <span class="comment">* Define sub-circuit</span>
                <p>
                  .subckt&nbsp;
                  <input
                    type="text"
                    id="subckt-name"
                    placeholder="Give a name to the subcircuit"
                  />&nbsp;
                  <input
                    type="text"
                    id="subckt-in1-name"
                    placeholder="Give a name to input 1"
                  />&nbsp;
                  <input
                    type="text"
                    id="subckt-in2-name"
                    placeholder="Give a name to input 2"
                  />&nbsp;
                  <input
                    type="text"
                    id="subckt-out-name"
                    placeholder="Give a name to the output"
                  /><br />
                  <input
                    type="text"
                    id="nmos1-name"
                    placeholder="Give an instance name to nmos 1"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos1-drain-terminal"
                    placeholder="Drain terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos1-gate-terminal"
                    placeholder="Gate terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos1-source-terminal"
                    placeholder="Source terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos1-body-terminal"
                    placeholder="Body terminal"
                  />&nbsp; nmos w={Wmin} L={Lmin}<br />
                  <input
                    type="text"
                    id="nmos2-name"
                    placeholder="Give an instance name to nmos 2"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos2-drain-terminal"
                    placeholder="Drain terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos2-gate-terminal"
                    placeholder="Gate terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos2-source-terminal"
                    placeholder="Source terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="nmos2-body-terminal"
                    placeholder="Body terminal"
                  />&nbsp; nmos w={Wmin} L={Lmin}<br /><br />
                  <input
                    type="text"
                    id="pmos1-name"
                    placeholder="Give an instance name to pmos 1"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos1-drain-terminal"
                    placeholder="Drain terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos1-gate-terminal"
                    placeholder="Gate terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos1-source-terminal"
                    placeholder="Source terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos1-body-terminal"
                    placeholder="Body terminal"
                  />&nbsp; pmos w={Wmin} L={Lmin}
                  <br />
                  <input
                    type="text"
                    id="pmos2-name"
                    placeholder="Give an instance name to pmos 2"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos2-drain-terminal"
                    placeholder="Drain terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos2-gate-terminal"
                    placeholder="Gate terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos2-source-terminal"
                    placeholder="Source terminal"
                  />&nbsp;
                  <input
                    type="text"
                    id="pmos2-body-terminal"
                    placeholder="Body terminal"
                  />&nbsp; pmos w={Wmin} L={Lmin}
                  <br />
                  .ends
                  <input
                    type="text"
                    id="end-subckt-name"
                    placeholder="Enter the subckt name"
                  />
                </p>
              </li>
              <li
                id="4"
                style="border-left: 6px solid #ff3860; background: #fff0f0"
              >
                <span class="comment"
                  >*netlist statement to call the gate sub circuit</span
                >
                <span class="comment"
                  >*gate inputs are 'a', 'b' and the gate output is 'out'</span
                >
                <p>
                  <input
                    type="text"
                    id="gate-call-instance-name"
                    placeholder="Give an instance name to the gate component"
                  />&nbsp;
                  <input
                    type="text"
                    id="gate-call-input1"
                    placeholder="Input Node 1"
                  />&nbsp;
                  <input
                    type="text"
                    id="gate-call-input2"
                    placeholder="Input Node 2"
                  />&nbsp;
                  <input
                    type="text"
                    id="gate-call-output"
                    placeholder="Output Node"
                  />&nbsp;
                  <input
                    type="text"
                    id="gate-call-subckt-name"
                    placeholder="Enter the sub circuit name to be called"
                  />
                </p>
              </li>
              <li
                id="5"
                style="border-left: 6px solid #00d1b2; background: #e6fff9"
              >
                <span class="comment">*Declaring Input Waveform</span><br />
                .PARAM trfin=10p<br />
                .PARAM t1 = 10n<br />
                .PARAM t2 = 20n<br />
                .PARAM t3 = 30n<br />
                .PARAM t4 = 40n<br />
                .PARAM t5 = 1*8000p+1200p<br />
                .PARAM t6 = 1*8000p+1210p<br />
                .PARAM t7 = 1*8000p+5200p<br />
                .PARAM t8 = 1*8000p+5210p<br /><br />
                <span class="comment">*Transient Analysis</span><br />
                .tran 6p 50n<br /><br />
                <span class="comment">
                  *Use below line for input (declaring input pwl Waveform)<br />
                  *'V1' is the PWL source name, 'a', 'b' are the input names </span
                ><br />
                V1 a 0 PWL (0 0 't1' 0 't2' 0 't2+trfin' 'supply' 't3' 'supply'
                't4' 'supply')
                <br />
                V2 b 0 PWL (0 0 't1' 0 't1+trfin' 'supply' 't2' 'supply' 't3'
                'supply' 't3+trfin' 0 't4' 0)
              </li>
              <li
                id="6"
                style="border-left: 6px solid #7957d5; background: #f3eaff"
              >
                <span class="comment">*Control Statements</span><br />
                .control<br />
                run<br /><br />
                <span class="comment">*plots inputs</span>
                <br />
                plot v(a) v(b)<br /><br />
                <span class="comment">*plots output</span>
                <br />
                plot v(out)<br /><br />
                .endc
              </li>
              <li
                id="7"
                style="border-left: 6px solid #363636; background: #f5f5f5"
              >
                <span class="comment">*End of the code</span><br />
                .end
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="column is-3-desktop is-10-tablet is-11-mobile center-content">
        <div class="v-datalist-container">
          <div class="v-datalist-title">Observations</div>
          <div class="v-datalist-row">
            <div id="result"></div>
            <div id="obs-table"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const currentTab = { NAND: 0, NOR: 1 };
        window.selectedTab =
          parseInt(localStorage.getItem("selectedTab")) || currentTab.NAND;
        const updateCommentText = () => {
          const commentSpan = document.getElementById("first_line");
          commentSpan.textContent =
            selectedTab === currentTab.NAND ? "* nand_gate *" : "* nor_gate *";
        };
        const setInitialTab = () => {
          const tabs = document.querySelectorAll(".v-tabs li");
          tabs.forEach((item) => item.classList.remove("is-active"));
          tabs[selectedTab].classList.add("is-active");
        };
        updateCommentText();
        setInitialTab();
        const tabs = document.querySelectorAll(".v-tabs li");
        tabs.forEach((tab, index) => {
          tab.addEventListener("click", () => {
            if (selectedTab !== index) {
              localStorage.setItem("selectedTab", index);
              location.reload();
            }
          });
        });
      });
    </script>
    <script src="./js/main.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/gh/virtual-labs/virtual-style@0.0.8-b/js/script.js"></script>
  </body>
</html>
